<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Scanner Input Validation Test</h1>
    
    <div class="test-section">
        <h2>1. ID Format Validation Tests</h2>
        <div id="formatTests"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Scanner Input Detection Tests</h2>
        <div id="scannerTests"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Interactive Test</h2>
        <p>Test the scanner input handling:</p>
        <input type="text" id="testInput" placeholder="Enter or scan a volunteer ID...">
        <button onclick="testInput()">Test Input</button>
        <div id="interactiveResult"></div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        // Test ID format validation
        function testIdValidation() {
            const testCases = [
                { id: 'V001', expected: true, description: 'Valid ID with prefix' },
                { id: '12345', expected: true, description: 'Valid numeric ID' },
                { id: 'ABC123', expected: true, description: 'Valid alphanumeric ID' },
                { id: 'USER-001', expected: true, description: 'Valid ID with hyphen' },
                { id: 'USER_001', expected: true, description: 'Valid ID with underscore' },
                { id: '', expected: false, description: 'Empty ID' },
                { id: '   ', expected: false, description: 'Whitespace only' },
                { id: 'A'.repeat(25), expected: false, description: 'Too long ID' },
                { id: 'ID@123', expected: false, description: 'Invalid characters' },
                { id: 'ID 123', expected: false, description: 'Space in ID' },
                { id: null, expected: false, description: 'Null ID' },
                { id: undefined, expected: false, description: 'Undefined ID' }
            ];

            const resultsDiv = document.getElementById('formatTests');
            let passCount = 0;

            testCases.forEach((testCase, index) => {
                const result = Utils.Validation.validateVolunteerIdDetailed(testCase.id);
                const passed = result.isValid === testCase.expected;
                
                if (passed) passCount++;

                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>Test ${index + 1}:</strong> ${testCase.description}<br>
                    <strong>Input:</strong> ${JSON.stringify(testCase.id)}<br>
                    <strong>Expected:</strong> ${testCase.expected}<br>
                    <strong>Actual:</strong> ${result.isValid}<br>
                    ${result.error ? `<strong>Error:</strong> ${result.error}<br>` : ''}
                    <strong>Result:</strong> ${passed ? 'PASS' : 'FAIL'}
                `;
                resultsDiv.appendChild(resultDiv);
            });

            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passCount === testCases.length ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `<strong>Summary:</strong> ${passCount}/${testCases.length} tests passed`;
            resultsDiv.appendChild(summaryDiv);
        }

        // Test scanner input detection
        function testScannerDetection() {
            const testCases = [
                { input: 'V001', duration: 50, expected: false, description: 'Short manual input' },
                { input: 'VOLUNTEER123', duration: 100, expected: true, description: 'Long fast input (scanner)' },
                { input: 'ABC123', duration: 2000, expected: false, description: 'Medium input, slow typing' },
                { input: 'VERYLONGBARCODE123456', duration: 200, expected: true, description: 'Very long input (definitely scanner)' },
                { input: '12345', duration: 300, expected: true, description: 'Medium length, fast input' },
                { input: 'AB', duration: 50, expected: false, description: 'Too short for scanner' }
            ];

            const resultsDiv = document.getElementById('scannerTests');
            let passCount = 0;

            testCases.forEach((testCase, index) => {
                const result = Utils.Validation.isScannerInput(testCase.input, testCase.duration);
                const passed = result === testCase.expected;
                
                if (passed) passCount++;

                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>Test ${index + 1}:</strong> ${testCase.description}<br>
                    <strong>Input:</strong> "${testCase.input}" (${testCase.input.length} chars)<br>
                    <strong>Duration:</strong> ${testCase.duration}ms<br>
                    <strong>Expected:</strong> ${testCase.expected ? 'Scanner' : 'Manual'}<br>
                    <strong>Actual:</strong> ${result ? 'Scanner' : 'Manual'}<br>
                    <strong>Result:</strong> ${passed ? 'PASS' : 'FAIL'}
                `;
                resultsDiv.appendChild(resultDiv);
            });

            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passCount === testCases.length ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `<strong>Summary:</strong> ${passCount}/${testCases.length} tests passed`;
            resultsDiv.appendChild(summaryDiv);
        }

        // Interactive test
        function testInput() {
            const input = document.getElementById('testInput').value;
            const resultDiv = document.getElementById('interactiveResult');
            
            // Test validation
            const validation = Utils.Validation.validateVolunteerIdDetailed(input);
            
            // Test sanitization
            const sanitized = Utils.Validation.sanitizeVolunteerId(input);
            
            resultDiv.innerHTML = `
                <div class="test-result info">
                    <strong>Original Input:</strong> "${input}"<br>
                    <strong>Sanitized:</strong> "${sanitized}"<br>
                    <strong>Valid Format:</strong> ${validation.isValid ? 'Yes' : 'No'}<br>
                    ${validation.error ? `<strong>Error:</strong> ${validation.error}<br>` : ''}
                    <strong>Length:</strong> ${input.length} characters<br>
                    <strong>Would be processed:</strong> ${validation.isValid ? 'Yes' : 'No'}
                </div>
            `;
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testIdValidation();
            testScannerDetection();
        });

        // Allow Enter key in test input
        document.getElementById('testInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                testInput();
            }
        });
    </script>
</body>
</html>